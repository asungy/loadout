# Bootstrap

This document provides suggestions for how to get a fresh installation of NixOS
to a desired state. Please use discretion where needed.

## Create Bootable USB Drive
1. Download [NixOS ISO image][nixos_download].
2. Download [Etcher][etcher] (USB graphical tool).
3. Use Etcher and NixOS ISO image to create bootable USB drive.

## Installing NixOS
Boot the NixOS installer from the USB drive created above.

## Building Loadout
Clone the `asungy/loadout` repo and navigate to the `loadout/` directory.
```bash
nix-shell -p git
git clone --depth=1 --branch=main https://github.com/asungy/loadout
cd loadout/
```
Once inside the directory, there is a bash script called `x` that is used help
apply changes to the system configuration. **DO NOT RUN THIS SCRIPT YET**.

### IMPORTANT
> Work may be done in the future to optimise this process.

Do the following before running the `x` script:
- [ ] Copy the `hardware-configuration.nix` file to the appropriate directory
  in `system/machine`.
  - This file is automatically generated by NixOS during installation.
  - To regenerate, run `sudo nixos-generate-config`.

- [ ] Ensure that the target username matches your current username.
  - To verify this, run the bash command: `echo $USER`.
  - Ensure that this username matches the username this line of the `x` script:
  ```
  nix build .#homeConfigurations.<USERNAME>.activationPackage
  ```
  - Also ensure that all relevant files using a username match as well.
  - A strategy would be to grep the current username in all files and replace
    it with your username.

- [ ] Ensure that the target machine matches the appropriate module where the
  `hardware-configuration.nix` file was placed.
  - To verify this, track the module in the `system/` directory to the module
    that contains the `hardware-configuration.nix` file imported.
  - Ensure that the module in the `system/` directory is targeted by the
    `nixos-rebuild` command in the `x` script.

- [ ] If any of this is confusing, don't proceed until you understand what you
  are doing (or proceed and learn from the mess that will ensue).

### Running the `x` program.
After the above items have be completed, the `x` program can be run with the following command:
```bash
nix run .#x
```
This will allow you to apply the system configurations as well as set up [Home
Manager][home_manager_wiki] for the targeted user.

### Restart
A computer restart may be necessary to observe desired changes.

### (Optional) Reset loadout remote to use SSH
- Create SSH key
- Add to GitHub
- Check remote addresses:
```bash
git remote -v
```
- Change to remote to SSH address
```bash
git remote set-url origin git@github.com:asungy/loadout.git
```

[etcher]: https://etcher.balena.io/
[home_manager_wiki]: https://nixos.wiki/wiki/Home_Manager
[nixos_download]: https://nixos.org/download.html#nixos-iso

